(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{318:function(n,e,r){"use strict";r.r(e),e.default='---\r\ndate: 19 Apr 2020\r\ndesc: Nginx server blocks with PM2 configuration for NuxtJs application (Two NuxtJs applications running on single public IP)\r\nimgDesc: \'Image is a screen shot of logos\'\r\nname: \'nginx-pm2-nuxtjs\'\r\nnoMainImage: True\r\ntitle: "Nginx with PM2 for NuxtJs"\r\naltLang: false\r\n---\r\n<div>\r\n    <adsbygoogle />\r\n</div>\r\n<Adsense\r\n          data-ad-client="ca-pub-3042269102042405"\r\n          data-ad-slot="1234567890"\r\n/>\r\n\r\nThe configurations & settings mentioned in this article were tested on Ubuntu operating system with\r\nNode.js server. Nginx is used as a reverse proxy & PM2 is used as a production process manager.\r\n\r\n**Prerequisites**  \r\nInstall Node.js, Nginx & PM2 with the proper version.  \r\nInstall two NuxtJs applications example1 & example2.  \r\nAnd we have two domains `example1.com` & `example2.com` with one public IP xxx.xx.xxx.xx.\r\n\r\n## Nginx server blocks\r\n\r\n**Create two server block files**\r\n\r\n<div class="codeBlocks">\r\n\r\n```linux\r\n# From any folder, go to \r\nNginx server block files location\r\n$ cd /etc/nginx/sites-available/\r\n\r\n# Create server block files & delete default file\r\n$ ls > example1.com\r\n$ ls > example2.com\r\n$ rm default\r\n\r\n```\r\n</div>\r\n\r\n**Edit server block files**  \r\nRead <https://nuxtjs.org/faq/nginx-proxy/> for the latest changes on Nginx server block settings.\r\n`example1.com` will run on port   `http://127.0.0.1:3000` & `example2.com` will run on port `http://127.0.0.1:4000`.\r\n\r\n<div class="codeBlocks">\r\n\r\n```linux        \r\n\r\n# Open the file in the nano editor\r\n$sudo nano example1.com\r\n# Enter the below configurations inside the file\r\nmap $sent_http_content_type $expires {\r\n"text/html"                 epoch;\r\n"text/html; charset=utf-8"  epoch;\r\ndefault                     off;\r\n}\r\nserver {\r\nlisten          80;# the port nginx is listening on\r\nserver_name     example1.com www.example1.com;\r\n# setup your domain here\r\ngzip            on;\r\ngzip_types      text/plain application/xml \r\n                text/css application/javascript;\r\ngzip_min_length 1000;\r\nlocation / {\r\n expires $expires;\r\n proxy_redirect          off;\r\n proxy_set_header Host       $host;\r\n proxy_set_header X-Real-IP  $remote_addr;\r\n proxy_set_header X-Forwarded-For    \r\n                    $proxy_add_x_forwarded_for;\r\n proxy_set_header X-Forwarded-Proto  $scheme;\r\n proxy_read_timeout          1m;\r\n proxy_connect_timeout       1m;\r\n proxy_pass http://127.0.0.1:3000; \r\n    #set the address of the Node.js instance here\r\n}\r\n}\r\n# Save & close the file\r\n# Similary open example2.com file, \r\nenter the above configurations, \r\nsave & close the file.\r\n# Be sure to changes server_name & proxy_pass with \r\n"example2.com www.example2.com" \r\n& "http://127.0.0.1:4000" respectively\r\n\r\n# Create symbolic links for server blocks from \r\nsites-available folder to sites-enabled folder\r\n$ sudo ln -s /etc/nginx/sites-available/example1.com \r\n             /etc/nginx/sites-enabled/\r\n$ sudo ln -s /etc/nginx/sites-available/example2.com \r\n             /etc/nginx/sites-enabled/\r\n\r\n# Delete default file from sites-enabled folder\r\n$ sudo rm /etc/nginx/sites-enabled/default\r\n\r\n```        \r\n</div>\r\n\r\n**Start Nginx server**\r\n\r\n<div class="codeBlocks">\r\n\r\n```linux\r\n# To start & stop nginx\r\n$ sudo service nginx start\r\n$ sudo service nginx stop\r\n\r\n# To test nginx for any errors\r\n$ sudo nginx -t\r\n\r\n# To restart nginx\r\n$ sudo systemctl restart nginx\r\n\r\n```\r\n</div>\r\n\r\n**PM2 configuarions**  \r\nAssumed two nuxt application installed in the below folder location\r\n/home/user/exapmle1/\r\n/home/user/example2/\r\n\r\n<div class="codeBlocks">\r\n\r\n```linux\r\n# Create PM2 ecosystem.config.js file. \r\n#"PM2 init" command creates ecosystem.config.js file\r\n$ cd /home/user/\r\n$ sudo PM2 init\r\n\r\n#Edit ecosystem.config.js file in nano editor\r\n$ sudo nano ecosystem.config.js\r\n# Enter the below settings\r\nmodule.exports = {\r\napps : [\r\n {\tname: \'example1\',\r\n    port: 3000,\r\n\texec_mode:\'cluster\',\r\n\tscript: "./node_modules/nuxt/bin/nuxt.js",\r\n\tcwd:\'./example1/\',\r\n\targs: \'start\',\r\n},\r\n{\tname: \'example2\',\r\n    port: 4000,\r\n    exec_mode:\'cluster\',\r\n    script: "./node_modules/nuxt/bin/nuxt.js",\r\n    cwd:\'./example2/\',\r\n    args: \'start\',\r\n}\r\n]\r\n}\r\n# Save & close the file\r\n```\r\n</div>\r\n\r\n**Start applications**\r\n\r\nThe below command will start example1 & example2 applications. \r\nYou have successfully configured and you can test\r\nas `http://example1.com` & `http://example2.com` in the browser.\r\n\r\n<div class="codeBlocks">\r\n\r\n```linux\r\n$ PM2 start\r\n```\r\n</div>\r\n\r\nReference for the above article:  \r\nhttps://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-server-blocks-virtual-hosts-on-ubuntu-16-04  \r\nhttps://nuxtjs.org/faq/nginx-proxy/\r\n\r\n\r\n<style>\r\n\r\n\r\n</style>'}}]);